---
title: Project
subtitle: "Details of the projects research method"
comments: false
title-block-banner: "#f6f8fa"
format:
  html:
    page-layout: full
---

The interactive graphic below shows the steps of the NASCENT-Peru project workflow for creating and simulating normative, nature-positive scenarios for future landscape development in Peru. Click on each step to learn more about it.

<button id="markmap-toggle">Show project overview</button>

```{=html}
<svg id="markmap"></svg>

<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://cdn.jsdelivr.net/npm/markmap-lib@0.15"></script>
<script src="https://cdn.jsdelivr.net/npm/markmap-view"></script>

<script type="module">
  const ROOT_COLOR = "#166F75";
  const BRANCH_COLORS = ["#42792E", "#6A8D29", "#04735B", "#3A8B95"];

  const markdown = String.raw`
# <img src="https://nascent-peru.github.io/img/NASCENT_logo_horizontal_upscayl.png" alt="Alt Text" width="400" /><span style="font-weight:bold; color:${ROOT_COLOR};"></span>
## <a href="#scenario-creation"><img src="../../img/scenario_creation.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[0]};">Create Normative Scenarios</span></a>
- <a href="#workshops"><img src="../../img/workshop_icon.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[0]};">Workshops</span>
- <a href="#narratives"><img src="../../img/narratives_icon.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[0]};">Narratives</span>
- <a href="#quantification"><img src="../../img/quantification_icon.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[0]};">Quantification</span>
## <a href="#scenario-modeling"><img src="../../img/modelling_icon.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[1]};">Model scenario impacts</span></a>
- <a href="#lulcc"><img src="../../img/lulc_icon.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[1]};"> Land Use Change</span>
- <a href="#es-modelling"><img src="../../img/es_icon.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[1]};">Ecosystem Services</span>
- <a href="#biodiversity-modelling"><img src="../../img/biodiversity_icon.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[1]};">Biodiversity</span>
## <a href="#economic-analysis"><img src="../../img/economic_icon.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[2]};">Summarize Environmental Impacts</span></a>
## <a href="#communication"><img src="../../img/communication_icon.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[3]};">Communication and Dissemination</span></a>
- <a href="#online-results"><img src="../../img/online-results-icon.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[3]};">Online results</span></a>
- <a href="#project-report"><img src="../../img/report_icon.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[3]};">Project report</span></a>
- <a href="#social-media"><img src="../../img/social_media_icon.svg" style="width:50px; height:50px; margin:5px; padding:5px; background-color:white; border-radius:4px; vertical-align:middle;" alt="" /><span style="font-weight:bold; color:${BRANCH_COLORS[3]};">Social Media</span></a>
`;

  const transformer = new window.markmap.Transformer();
  const { root } = transformer.transform(markdown);

  // Color the root node
  root._subtreeColor = ROOT_COLOR;

  // Assign each top-level branch its own color
  root.children.forEach((child, index) => {
    const branchColor = BRANCH_COLORS[index % BRANCH_COLORS.length];
    const markSubtree = (node) => {
      node._subtreeColor = branchColor;
      if (node.children) node.children.forEach(markSubtree);
    };
    markSubtree(child);
  });

  window.markmap.Markmap.create("#markmap", {
    initialExpandLevel: 2,
    autoFit: true,
    zoom: false,
    pan: false,
    color: node => node._subtreeColor || "#222"
  }, root);
  
  const toggleBtn = document.getElementById("markmap-toggle");
  const markmapEl = document.getElementById("markmap");

  toggleBtn.addEventListener("click", () => {
    const isVisible = markmapEl.classList.toggle("show");
    toggleBtn.textContent = isVisible ? "Hide Map" : "Show Map";
  });
</script>
```

:::: {#content}
## Creating Normative Scenarios {#scenario-creation}

The goal of the NASCENT-Peru project was not to create scenarios that describe what is likely to happen in the future, instead we aimed to create scenarios that describe what diverse stakeholders in Peru want to happen in the future, i.e. normative scenarios. Specifically, our scenarios capture different perspectives on desirable future landscapes for Peru, what characterizes these landscapes, and what societal and environmental changes are needed to achieve them. To develop our scenarios we used a participatory approach that involved a series of workshops and online activities to gather input from stakeholders and experts combined with literature review. This process is represented visually in the diagram below with further details in the sections that follow. We have also created a 'scrolly-telling' article that walks you through the scenario creation process step by step, which you can access using the link below or under the Outputs menu at the top of the page.

::: {.center style="font-size: 1.5em; font-weight: bold;"}
[Click here for an interactive walkthrough of the whole scenario creation process](../project/project_scrolly.qmd)
:::

### Workshops {#workshops}

The project's participatory process involved a series of workshops, both national and regional, that bring together stakeholders and experts. The aim was to collaboratively identify desirable and undesirable aspects of future landscape change.

```{r}
#| echo: false
#| warning: false

library(leaflet)
library(fontawesome) #devtools::install_github("rstudio/fontawesome")
library(mapview)
library(leaflet.providers)
library(htmltools)




national <- makeAwesomeIcon(text = fa("people-roof"),
                              library = 'fa',
                              markerColor = 'white',
                              iconColor = '#42792E')
  
regional <- makeAwesomeIcon(text = fa("people-roof"),
                              library = 'fa',
                              markerColor = 'white',
                              iconColor = '#166F75')


#uncomment for saving map
#Workshop_locations <- 
 m <- leaflet(options = leafletOptions(zoomControl = FALSE,
                                 attributionControl=FALSE)) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  #addTiles() %>%  # Add default OpenStreetMap map tiles
  addAwesomeMarkers(lng=-77.043,
                    lat=-12.038,
                    icon= national,
                    popup="Lima, National Workshop 9th May",
                    label = "Lima, National Workshop, 9th May",
                    labelOptions = labelOptions(#noHide = TRUE,
                                                direction = "bottom",
                                                style = list("color" = "black",
                                                "font-family" = "Roboto",
                                                "font-style" = "italic",
                                                "box-shadow" = "3px 3px rgba(0,0,0,0.25)",
                                                "font-size" = "12px",
                                                "border-color" = "rgba(0,0,0,0.5)")))%>%
  addAwesomeMarkers(lng=-69.189, lat=-12.594, icon = regional, popup="Puerto Maldonado, Regional Workshop", label = "Puerto Maldonado Regional Workshop 28th May",
                    labelOptions = labelOptions(#noHide = TRUE,
                                                direction = "bottom",
                                                style = list("color" = "black",
                                                "font-family" = "Roboto",
                                                "font-style" = "italic",
                                                "box-shadow" = "3px 3px rgba(0,0,0,0.25)",
                                                "font-size" = "12px",
                                                "border-color" = "rgba(0,0,0,0.5)")))%>%
  addAwesomeMarkers(lng=-77.529, lat=-9.526, icon = regional, popup="Huaraz, Regional Workshop", label = "Huaraz, Regional Workshop 4th June",
                    labelOptions = labelOptions(#noHide = TRUE,
                                                direction = "bottom",
                                                style = list("color" = "black",
                                                "font-family" = "Roboto",
                                                "font-style" = "italic",
                                                "box-shadow" = "3px 3px rgba(0,0,0,0.25)",
                                                "font-size" = "12px",
                                                "border-color" = "rgba(0,0,0,0.5)")))%>%
  addAwesomeMarkers(lng=-76.370, lat=-6.485, icon = regional, popup="Tarapoto, Regional Workshop", label = "Tarapoto, Regional Workshop 10th June",
                    labelOptions = labelOptions(#noHide = TRUE,
                                                direction = "bottom",
                                                style = list("color" = "black",
                                                "font-family" = "Roboto",
                                                "font-style" = "italic",
                                                "box-shadow" = "3px 3px rgba(0,0,0,0.25)",
                                                "font-size" = "12px",
                                                "border-color" = "rgba(0,0,0,0.5)")))%>%
  addAwesomeMarkers(lng=-80.63282, lat=-5.19449, icon = regional, popup="Piura, Regional Workshop", label="Piura, Regional Workshop 20th May",
                    labelOptions = labelOptions(#noHide = TRUE,
                                                direction = "bottom",
                                                style = list("color" = "black",
                                                "font-family" = "Roboto",
                                                "font-style" = "italic",
                                                "box-shadow" = "3px 3px rgba(0,0,0,0.25)",
                                                "font-size" = "12px",
                                                "border-color" = "rgba(0,0,0,0.5)")))
# Set the width of the map (e.g., 70%)
tagList(
  tags$div(
    style = "width: 70%; margin: auto;",  # Adjust % or use px (e.g., 800px)
    m
  )
)
  

#save as html
# mapview::mapshot2(x= Workshop_locations,
#                   url =  "img/Workshop_locations.html",
#                   remove_controls = NULL,
#                   cliprect = "viewport",
#                   selfcontained = TRUE)


# #save image
# mapview::mapshot2(x= Workshop_locations,
#                   file = "img/workshop_locations.png",
#                   remove_controls = TRUE,
#                   #vwidth=1800,
#                   #vheight=950,
#                   #cliprect = "viewport",
#                   cliprect = c(40, 30, 620, 875), #ALL OF PERU
#                   expand= c(400,0,0,700),
#                   #,selfcontained = TRUE
#                   )

```

Here are some pictures from the workshops:

```{=html}
<style>
.carousel-item img {
  cursor: pointer;
  transition: transform 0.2s;
}

.carousel-item img:hover {
  transform: scale(1.02);
}

.carousel-caption {
  background: rgba(0,0,0,0.7);
  border-radius: 5px;
  padding: 10px;
}

#imageCarousel {
  max-width: 800px;
  margin: 0 auto;
}

#imageCarousel .carousel-item img {
  height: 533px; /* Maintains 1600x1067 aspect ratio at 800px width */
  width: 100%;
  object-fit: cover;
}
</style>

<!-- Bootstrap Carousel with Lightbox -->
<div id="imageCarousel" class="carousel slide" data-bs-ride="carousel">
  <!-- Indicators -->
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="3" aria-label="Slide 4"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="4" aria-label="Slide 5"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="5" aria-label="Slide 6"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="6" aria-label="Slide 7"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="7" aria-label="Slide 8"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="8" aria-label="Slide 9"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="9" aria-label="Slide 10"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="10" aria-label="Slide 11"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="11" aria-label="Slide 12"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="12" aria-label="Slide 13"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="13" aria-label="Slide 14"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="14" aria-label="Slide 15"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="15" aria-label="Slide 16"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="16" aria-label="Slide 17"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="17" aria-label="Slide 18"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="18" aria-label="Slide 19"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="19" aria-label="Slide 20"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="20" aria-label="Slide 21"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="21" aria-label="Slide 22"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="22" aria-label="Slide 23"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="23" aria-label="Slide 24"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="24" aria-label="Slide 25"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="25" aria-label="Slide 26"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="26" aria-label="Slide 27"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="27" aria-label="Slide 28"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="28" aria-label="Slide 29"></button>
    <button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="29" aria-label="Slide 30"></button>
  </div>
  
  <!-- Carousel Items -->
  <div class="carousel-inner">
    <div class="carousel-item active">
      <a href="../../img/Piura_1.JPG" data-lightbox="carousel-gallery" data-title="Piura 1">
        <img src="../../img/Piura_1.JPG" class="d-block w-100" alt="Piura 1">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Piura_2.JPG" data-lightbox="carousel-gallery" data-title="Piura 2">
        <img src="../../img/Piura_2.JPG" class="d-block w-100" alt="Piura 2">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Piura_3.JPG" data-lightbox="carousel-gallery" data-title="Piura 3">
        <img src="../../img/Piura_3.JPG" class="d-block w-100" alt="Piura 3">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Piura_group.JPG" data-lightbox="carousel-gallery" data-title="Piura Group">
        <img src="../../img/Piura_group.JPG" class="d-block w-100" alt="Piura Group">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Puerto_1.JPG" data-lightbox="carousel-gallery" data-title="Puerto 1">
        <img src="../../img/Puerto_1.JPG" class="d-block w-100" alt="Puerto 1">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Puerto_2.JPG" data-lightbox="carousel-gallery" data-title="Puerto 2">
        <img src="../../img/Puerto_2.JPG" class="d-block w-100" alt="Puerto 2">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Puerto_3.jpg" data-lightbox="carousel-gallery" data-title="Puerto 3">
        <img src="../../img/Puerto_3.jpg" class="d-block w-100" alt="Puerto 3">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Puerto_4.jpg" data-lightbox="carousel-gallery" data-title="Puerto 4">
        <img src="../../img/Puerto_4.jpg" class="d-block w-100" alt="Puerto 4">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Puerto_group.JPG" data-lightbox="carousel-gallery" data-title="Puerto Group">
        <img src="../../img/Puerto_group.JPG" class="d-block w-100" alt="Puerto Group">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Taller_Nacional-17.jpg" data-lightbox="carousel-gallery" data-title="Taller Nacional 17">
        <img src="../../img/Taller_Nacional-17.jpg" class="d-block w-100" alt="Taller Nacional 17">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Taller_Nacional-52.jpg" data-lightbox="carousel-gallery" data-title="Taller Nacional 52">
        <img src="../../img/Taller_Nacional-52.jpg" class="d-block w-100" alt="Taller Nacional 52">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Taller_Nacional-61.jpg" data-lightbox="carousel-gallery" data-title="Taller Nacional 61">
        <img src="../../img/Taller_Nacional-61.jpg" class="d-block w-100" alt="Taller Nacional 61">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Taller_Nacional-87.jpg" data-lightbox="carousel-gallery" data-title="Taller Nacional 87">
        <img src="../../img/Taller_Nacional-87.jpg" class="d-block w-100" alt="Taller Nacional 87">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Taller_Nacional-112.jpg" data-lightbox="carousel-gallery" data-title="Taller Nacional 112">
        <img src="../../img/Taller_Nacional-112.jpg" class="d-block w-100" alt="Taller Nacional 112">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Tarapoto_1.jpg" data-lightbox="carousel-gallery" data-title="Tarapoto 1">
        <img src="../../img/Tarapoto_1.jpg" class="d-block w-100" alt="Tarapoto 1">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Tarapoto_2.jpg" data-lightbox="carousel-gallery" data-title="Tarapoto 2">
        <img src="../../img/Tarapoto_2.jpg" class="d-block w-100" alt="Tarapoto 2">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Tarapoto_3.jpg" data-lightbox="carousel-gallery" data-title="Tarapoto 3">
        <img src="../../img/Tarapoto_3.jpg" class="d-block w-100" alt="Tarapoto 3">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Tarapoto_4.jpg" data-lightbox="carousel-gallery" data-title="Tarapoto 4">
        <img src="../../img/Tarapoto_4.jpg" class="d-block w-100" alt="Tarapoto 4">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Tarapoto_5.jpg" data-lightbox="carousel-gallery" data-title="Tarapoto 5">
        <img src="../../img/Tarapoto_5.jpg" class="d-block w-100" alt="Tarapoto 5">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Tarapoto_6.jpg" data-lightbox="carousel-gallery" data-title="Tarapoto 6">
        <img src="../../img/Tarapoto_6.jpg" class="d-block w-100" alt="Tarapoto 6">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Tarapoto_group.jpg" data-lightbox="carousel-gallery" data-title="Tarapoto Group">
        <img src="../../img/Tarapoto_group.jpg" class="d-block w-100" alt="Tarapoto Group">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Tarapoto_pres_3.jpg" data-lightbox="carousel-gallery" data-title="Tarapoto Presentation 3">
        <img src="../../img/Tarapoto_pres_3.jpg" class="d-block w-100" alt="Tarapoto Presentation 3">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Tarapoto_pres_4.jpg" data-lightbox="carousel-gallery" data-title="Tarapoto Presentation 4">
        <img src="../../img/Tarapoto_pres_4.jpg" class="d-block w-100" alt="Tarapoto Presentation 4">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Huaraz_1.jpg" data-lightbox="carousel-gallery" data-title="Huaraz 1">
        <img src="../../img/Huaraz_1.jpg" class="d-block w-100" alt="Huaraz 1">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Huaraz_2.jpg" data-lightbox="carousel-gallery" data-title="Huaraz 2">
        <img src="../../img/Huaraz_2.jpg" class="d-block w-100" alt="Huaraz 2">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Huaraz_3.jpeg" data-lightbox="carousel-gallery" data-title="Huaraz 3">
        <img src="../../img/Huaraz_3.jpeg" class="d-block w-100" alt="Huaraz 3">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Huaraz_4.jpeg" data-lightbox="carousel-gallery" data-title="Huaraz 4">
        <img src="../../img/Huaraz_4.jpeg" class="d-block w-100" alt="Huaraz 4">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Huaraz_5.jpeg" data-lightbox="carousel-gallery" data-title="Huaraz 5">
        <img src="../../img/Huaraz_5.jpeg" class="d-block w-100" alt="Huaraz 5">
      </a>
    </div>
    <div class="carousel-item">
      <a href="../../img/Huaraz_group.jpeg" data-lightbox="carousel-gallery" data-title="Huaraz Group">
        <img src="../../img/Huaraz_group.jpeg" class="d-block w-100" alt="Huaraz Group">
      </a>
    </div>
  </div>
  
  <!-- Controls -->
  <button class="carousel-control-prev" type="button" data-bs-target="#imageCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#imageCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>
```

### Narratives {#narratives}

In addition to the workshops, an online survey is conducted. Based on the information gathered through the workshops and survey, explorative and normative scenarios are created. The exploratory scenarios consist of 'business as usual' and negative scenarios, while the normative scenarios consist of nature-positive scenarios.

### Quantification {#quantification}

The rates of land use and land cover change (LULCC) are determined for each scenario by quantifying the trends in socio-economic, biophysical, and climatic drivers.

## Model Scenario Impacts {#scenario-modeling}

During the simulation phase, the Ecosystem Services (ES) and species distribution for each scenario are determined, taking into account the future Land Use and Land Cover (LULC) as one of the input factors.

### Land Use Change {#lulcc}

### Ecosystem Services {#es-modelling}

### Biodiversity {#biodiversity-modelling}

## Summarize Environmental Impacts {#economic-analysis}

Ecosystem services influence a wide range of economic sectors, and future changes in these services will affect the Peruvian economy. To assess this impact, we examined the relationships between 8 ecosystem services and 7 economic sectors, using data from the [ENCORE database](https://www.encorenature.org/en), which evaluates sectoral dependencies on ecosystem services. Only the sectors relevant to Peru were included.

-   The spider diagram (right) allows you to explore the overall dependencies. Click on an ecosystem service to highlight it, or double-click to remove it from the diagram.

-   The bar plots (below) provide service-specific details. Use the tabs to switch between ecosystem services, and the drop-down menu to focus on a single economic sector.\

::::: grid
::: g-col-6
```{r}
#| echo: false
#| warning: false
#| fig-width: 8
#| fig-height: 8
library(dplyr)
library(tidyr)
library(plotly)
# Load ENCORE ES and economic impact for Peru DF from the data folder
peru <- read.csv("outputs/data/peru_diagram_df.csv")

peru$ISIC_cat[peru$ISIC_cat=="Public_admin"] <- "Public Administration"

# Map rating to numeric scale
rating_map <- c("VL" = 1, "L" = 2, "M" = 3, "H" = 4, "VH" = 5)

get_es_summary <- function(es_name, peru_data, all_cats) {
  rating_map <- c("VL" = 1, "L" = 2, "M" = 3, "H" = 4, "VH" = 5)
  
  peru_data %>%
    filter(Ecosystem_Service == es_name) %>%
    mutate(rating_num = rating_map[as.character(rating)]) %>%
    group_by(ISIC_cat) %>%
    summarise(max_rating = max(rating_num, na.rm = TRUE), .groups = "drop") %>%
    mutate(max_rating = ifelse(is.infinite(max_rating), NA, max_rating)) %>%
    right_join(data.frame(ISIC_cat = all_cats), by = "ISIC_cat") %>%
    mutate(max_rating = ifelse(is.na(max_rating), 0, max_rating)) %>%
    arrange(match(ISIC_cat, all_cats)) %>%
    pull(max_rating)
}

# Categories
all_cats <- c("Agriculture", "Mining", "Construction", 
              "Manufacturing", "Public Administration", "Transport", "Services")

# Select ES
selected_es <- c("Habitat_maint","Water_flow_reg", "Rec", "Poll", 
                 "Soil_ret", "Biomass", "Soil_qual", "Spirit_art")

# Collect ratings for each ES
ratings_list <- lapply(selected_es, get_es_summary, peru_data = peru, all_cats = all_cats)

# Build long-format dataframe for plotly
radar_data <- data.frame(
  ISIC_cat = rep(all_cats, times = length(selected_es)),
  Rating = unlist(ratings_list),
  ES = rep(selected_es, each = length(all_cats))
)

# Define nicer labels
es_labels <- c(
  "Habitat_maint" = "Habitat quality",
  "Poll"          = "Pollinator abundance",
  "Biomass"       = "Carbon stored in biomass",
  "Soil_qual"     = "Nutrient retention by landscape",
  "Soil_ret"      = "Sediment retention by landscape",
  "Water_flow_reg"= "Water yield",
  "Rec"           = "Recreation potential",
  "Spirit_art"    = "Emblematic species"
)

# Radar chart
p <- plot_ly(type = 'scatterpolar', mode = 'lines+markers')

for (es in selected_es) {
  df <- radar_data %>% filter(ES == es)
  p <- add_trace(
    p,
    r = df$Rating,
    theta = df$ISIC_cat,
    name = es_labels[es],
    fill = 'toself',
    hovertemplate = paste(
      "Ecosystem Service:", es, "<br>",
      "ISIC category: %{theta}<br>",
      "Rating: %{r}<extra></extra>"
    )
  )
}

p <- layout(
  p,
  polar = list(
    radialaxis = list(
      visible = TRUE,
      range = c(0, 5),
      tickvals = 0:5,
      ticktext = c("No", "VL", "L", "M", "H", "VH"),
      tickfont = list(size = 12)  # font size of radial ticks (numbers)
    ),
    angularaxis = list(
      tickfont = list(size = 10, color = "black", family = "Arial")  # category labels
    )
  ),
  showlegend = TRUE,
  legend = list(
    orientation = "h",   # horizontal legend
    x = 0.5,             # center horizontally
    y = -0.3,            # below the plot
    xanchor = "center",
    yanchor = "top",
    font = list(size = 10),
    tracegroupgap = 0,   # no gaps between items
    itemclick = "toggleothers", # optional: click hides others
    itemdoubleclick = "toggle"  # optional
  )
)

p
```
:::

::: g-col-6
::: {.panel-tabset}
#### Water Yield

```{r}
#| echo: false
#| warning: false
#| message: false
library(dplyr)
library(stringr)
library(tidyr)
library(plotly)

# Load ENCORE ES and economic impact for Peru DF from the data folder
peru <- read.csv("outputs/data/peru_diagram_df.csv")

# Canonical levels and colors
rating_levels <- c("Very low", "Low", "Medium", "High", "Very high")
rating_colors <- c(
  "Very low"  = "#1a9850",
  "Low"       = "#91cf60",
  "Medium"    = "#ffffbf",
  "High"      = "#fc8d59",
  "Very high" = "#d73027"
)

# Pretty labels
es_labels <- c(
  "Habitat_maint" = "Habitat quality",
  "Poll"          = "Pollinator abundance",
  "Biomass"       = "Carbon stored in biomass",
  "Soil_qual"     = "Nutrient retention by landscape",
  "Soil_ret"      = "Sediment retention by landscape",
  "Water_flow_reg"= "Water yield",
  "Rec"           = "Recreation potential",
  "Spirit_art"    = "Emblematic species"
)

# Ecosystem services to plot
selected_es <- c("Habitat_maint","Water_flow_reg", "Rec", "Poll", 
                 "Soil_ret", "Biomass", "Soil_qual", "Spirit_art")

# --- helper to clean and summarise ---
clean_ES_data <- function(df, ES) {
  df %>%
    filter(Ecosystem_Service == ES, !is.na(rating)) %>%
    mutate(
      rating = as.character(rating) |> str_trim(),
      rating = dplyr::recode(rating,
                             "VL" = "Very low", "L" = "Low", "M" = "Medium",
                             "H" = "High", "VH" = "Very high",
                             .default = rating
      ),
      rating = case_when(
        str_to_lower(rating) %in% c("very low","very-low") ~ "Very low",
        str_to_lower(rating) %in% c("low")                 ~ "Low",
        str_to_lower(rating) %in% c("medium","med")        ~ "Medium",
        str_to_lower(rating) %in% c("high")                ~ "High",
        str_to_lower(rating) %in% c("very high","very-high") ~ "Very high",
        TRUE ~ rating
      ),
      rating = factor(rating, levels = rating_levels)
    ) %>%
    filter(!is.na(rating))
}

build_summary <- function(df) {
  df %>%
    mutate(rating = as.character(rating)) %>%
    group_by(rating) %>%
    summarise(
      n_classes   = n(),
      classes_list = paste(sort(ISIC_class), collapse = "<br>"),
      .groups = "drop"
    ) %>%
    tidyr::complete(
      rating = rating_levels,
      fill = list(n_classes = 0, classes_list = "")
    ) %>%
    mutate(rating = factor(rating, levels = rating_levels)) %>%
    arrange(rating)
}

# --- function to build one plot for a given ES ---
make_plot <- function(ES) {
  ES_data <- clean_ES_data(peru, ES)
  
  all_sum <- build_summary(ES_data)
  cats    <- sort(unique(ES_data$ISIC_cat))
  
  cat_summaries <- lapply(cats, function(cat) {
    df <- build_summary(filter(ES_data, ISIC_cat == cat))
    df$ISIC_cat <- cat
    df
  })
  names(cat_summaries) <- cats
  
  # base figure
  p <- plot_ly()
  
  # All categories trace
  p <- add_bars(
    p, data = all_sum,
    x = ~rating, y = ~n_classes,
    text = ~paste0(
      "Category: All<br>",
      "Rating: ", rating, "<br>",
      "# classes: ", n_classes,
      ifelse(classes_list == "", "", paste0("<br><br>", classes_list))
    ),
    hovertemplate = "%{text}<extra></extra>",
    textposition  = "none",
    marker = list(color = unname(rating_colors[as.character(all_sum$rating)])),
    name = "All categories", visible = TRUE
  )
  
  # Per-category traces
  for (cat in cats) {
    df <- cat_summaries[[cat]]
    p <- add_bars(
      p, data = df,
      x = ~rating, y = ~n_classes,
      text = ~paste0(
        "Category: ", ISIC_cat, "<br>",
        "Rating: ", rating, "<br>",
        "# classes: ", n_classes,
        ifelse(classes_list == "", "", paste0("<br><br>", classes_list))
      ),
      hovertemplate = "%{text}<extra></extra>",
      textposition  = "none",
      marker = list(color = unname(rating_colors[as.character(df$rating)])),
      name = cat, visible = FALSE
    )
  }
  
  # Visibility setup
  n_traces   <- 1 + length(cats)
  vis_all    <- c(TRUE, rep(FALSE, length(cats)))
  vis_percat <- lapply(seq_along(cats), function(i) { v <- rep(FALSE, n_traces); v[i+1] <- TRUE; v })
  
  ymax_all <- max(all_sum$n_classes, 0)
  ymax_cat <- sapply(cat_summaries, function(df) max(df$n_classes, 0))
  
  buttons <- c(
    list(list(
      method = "update",
      label  = "All categories",
      args   = list(
        list(visible = vis_all),
        list(
          title = paste("Dependency on", es_labels[ES], "— All ISIC categories"),
          yaxis = list(range = c(0, max(1, ymax_all) * 1.1))
        )
      )
    )),
    lapply(seq_along(cats), function(i) {
      list(
        method = "update",
        label  = cats[i],
        args   = list(
          list(visible = vis_percat[[i]]),
          list(
            #title = paste("Dependency on", es_labels[ES], "—", cats[i]),
            yaxis = list(range = c(0, max(1, ymax_cat[i]) * 1.1))
          )
        )
      )
    })
  )
  
  p <- layout(
    p,
    barmode = "group",
    #title   = paste("Dependency on", es_labels[ES], "— All ISIC categories"),
    xaxis   = list(title = "Dependency rating"),
    yaxis   = list(title = "Number of ISIC classes"),
    showlegend = FALSE,
    updatemenus = list(list(
      type = "dropdown", y = 1.15, x = 0, showactive = TRUE, buttons = buttons
    ))
  )
  
  if (max(all_sum$n_classes) == 0) {
    p <- p %>% layout(
      annotations = list(list(
        x = 0.5, y = 0.5, xref = "paper", yref = "paper",
        text = "No ISIC classes with non-NA ratings for this ES",
        showarrow = FALSE
      ))
    )
  }
  
  return(p)
}

# --- generate plots for all selected services ---
plots <- lapply(selected_es, make_plot)
names(plots) <- selected_es

plots[["Water_flow_reg"]]  # show water yield

```

#### Pollinator Abundance

```{r}
#| echo: false
#| warning: false
#| message: false
plots[["Poll"]]            # show pollinator abundance
```

#### Habitat Quality

```{r}
#| echo: false
#| warning: false
#| message: false
plots[["Habitat_maint"]]  # show Habitat quality 
```

#### Recreation Potential

```{r}
#| echo: false
#| warning: false
#| message: false
plots[["Rec"]]            # show Recreation potential
```

#### Sediment Retention

```{r}
#| echo: false
#| warning: false
#| message: false
plots[["Soil_ret"]]       # show Sediment retention 
```

#### Carbon Stored in Biomass

```{r}
#| echo: false
#| warning: false
#| message: false
plots[["Biomass"]]        # show Carbon stored in biomass
```

#### Nutrient Retention

```{r}
#| echo: false
#| warning: false
#| message: false
plots[["Soil_qual"]]      # show Nutrient retention
```

#### Emblematic Species

```{r}
#| echo: false
#| warning: false
#| message: false
plots[["Spirit_art"]]     # show Emblematic species
```
:::
:::
:::::

## Communication and Dissemination {#communication}

As part of the project methodology, interim results will be presented to refine scenarios. The final results and the datasets will be made publicly available, contributing to the knowledge base for future projects.

### Online results {#online-results}

Sub pluribus dente, diva illi ac

### Social Media {#social-media}

Pyram tum illam armis adflabat. Ait obvius inde sumus tenuissima qui credere sentit [dextra](http://me-doleas.com/nonfaciat.php) Cythereiadasque [levitate](http://flexit.io/antiquique). Trachine grata; est rogat lenta pulveris, partimque circumdata, hunc arte postquam, matrisque, mea tamen.

Spectantur numero; adeundi quaerunt talia sacerdos scribit ferox corpora flumina **urgeturque scilicet misereri** mulcebunt tepida, at vivis pugnandi. Sororum suppositosque armo praecutiunt, de utero cacumine subito salutifera priorum stamina iubentque de tulit vocandus esse! Quoniam Lycii. Lecti laniata; ambo eque quasque, si **uterum cervix**.

### Project report {#project-report}

Sub pluribus dente, diva illi ac [mandata moenia](http://pars.com/postquaminicere) illi, c quam flumina, recessit loca. Abripit Lethaei crines tuae seque cupidine et, erat acres virorum illis.

Dare nec emittunt induit; parte *via criminis solvit* ignibus et solio. Sua meliore Crete non cum ignoscite forma; e munere. Ante his galeam serpens. Senemque illa sine solet et oculos pietasque quondam; est aquae, vestem, **in**?
::::
